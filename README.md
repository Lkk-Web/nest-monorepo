# NestJS Monorepo

åŸºäº NestJS æ¡†æ¶ï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„å’Œ Monorepoã€‚

### æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: NestJS 8.0.0+
- **è¯­è¨€**: TypeScript
- **æ•°æ®åº“**: MySQL
- **ORM**: Sequelize
- **è®¤è¯**: JWT
- **è¿›ç¨‹ç®¡ç†**: PM2
- **æ¶æ„**: å¾®æœåŠ¡ + Monorepo

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
nestjs-monorepo-hr1/
â”œâ”€â”€ apps/                    # åº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ main/               # ä¸»æœåŠ¡åº”ç”¨
â”‚   â””â”€â”€ auth/               # è®¤è¯å¾®æœåŠ¡
â”œâ”€â”€ libs/                   # å…±äº«åº“
â”‚   â”œâ”€â”€ utils/              # å·¥å…·åº“
â”‚   â””â”€â”€ script/             # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ config.example.yaml     # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ pm2.json               # PM2 é…ç½®
â””â”€â”€ nest-cli.json          # NestJS CLI é…ç½®
```

### ä¸»æœåŠ¡ç›®å½•ç»“æ„

```
apps/main/src/
â”œâ”€â”€ common/                 # å…¬ç”¨æ¨¡å—
â”‚   â”œâ”€â”€ config/            # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ dto/               # å…¬ç”¨ DTO
â”‚   â”œâ”€â”€ enum/              # å¸¸é‡æšä¸¾
â”‚   â”œâ”€â”€ error/             # é”™è¯¯å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ interface/         # TypeScript æ¥å£
â”‚   â””â”€â”€ type/              # TypeScript ç±»å‹
â”œâ”€â”€ core/                  # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ decorator/         # è£…é¥°å™¨
â”‚   â””â”€â”€ guards/            # å®ˆå«ï¼ˆJWT è®¤è¯ç­‰ï¼‰
â”œâ”€â”€ library/               # å…¬å…±åº“
â”‚   â”œâ”€â”€ logger/            # æ—¥å¿—æ¨¡å—
â”‚   â”œâ”€â”€ tasks/             # å®šæ—¶ä»»åŠ¡
â”‚   â””â”€â”€ microserviceClient/ # å¾®æœåŠ¡å®¢æˆ·ç«¯
â”œâ”€â”€ model/                 # æ•°æ®è¡¨ç»“æ„å®šä¹‰
â”œâ”€â”€ modules/               # ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ admin/             # ç®¡ç†å‘˜æ¨¡å—
â”‚   â”œâ”€â”€ client/            # å®¢æˆ·ç«¯æ¨¡å—
â”‚   â””â”€â”€ public/            # å…¬å¼€æ¥å£æ¨¡å—
â”œâ”€â”€ services/              # å…¬ç”¨æœåŠ¡
â””â”€â”€ main.ts               # åº”ç”¨å¯åŠ¨å…¥å£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: CentOS / Windows / macOS
- **Node.js**: 14.x ~ 16.18.0
- **npm**: 8.5.5+
- **PM2**: 5.0.0+

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install
# æˆ–è€…
yarn install

# å…¨å±€å®‰è£… NestJS CLIï¼ˆå¯é€‰ï¼‰
npm i -g @nestjs/cli
```

### é…ç½®æ–‡ä»¶

1. å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼š

   ```bash
   cp config.example.yaml config.yaml
   ```

2. ä¿®æ”¹ `config.yaml` ä¸­çš„é…ç½®é¡¹ï¼š
   - `PORT`: æœåŠ¡ç«¯å£
   - `APP_NAME`: åº”ç”¨åç§°
   - `HOME_PATH`: é¡¹ç›®è·¯å¾„
   - `DB_DATABASE`: æ•°æ®åº“é…ç½®

### å¯åŠ¨æœåŠ¡

#### å¼€å‘æ¨¡å¼

```bash
# å¯åŠ¨ä¸»æœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
npm run main

# å¯åŠ¨è®¤è¯æœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
npm run auth

# åŒæ—¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
npm run dev
```

#### ç”Ÿäº§æ¨¡å¼

```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒï¼ˆå•çº¿ç¨‹ï¼‰
npm run prod

# ä½¿ç”¨ PM2 å¯åŠ¨ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
pm2 start ./pm2.json
```

## ğŸ“ å¼€å‘æŒ‡å—

### å¸¸ç”¨å‘½ä»¤

```bash
# ç”Ÿæˆæ–°æ¨¡å—
nest g module user modules
nest g controller user modules
nest g service user modules

# æ„å»ºé¡¹ç›®
npm run build

# è¿è¡Œæµ‹è¯•
npm run test

# ä»£ç æ ¼å¼åŒ–
npm run format

# ä»£ç æ£€æŸ¥
npm run lint
```

### PM2 ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# é‡å¯æœåŠ¡
pm2 restart all

# åœæ­¢æœåŠ¡
pm2 stop all

# åˆ é™¤æœåŠ¡
pm2 delete all
```

## ğŸ”§ ç¯å¢ƒé…ç½®

### ç¯å¢ƒç±»å‹

- **dev**: å¼€å‘ç¯å¢ƒï¼ˆæœ¬åœ°ï¼‰
- **test**: æµ‹è¯•ç¯å¢ƒ
- **prod**: ç”Ÿäº§ç¯å¢ƒ

### æ—¥å¿—é…ç½®

é¡¹ç›®ä½¿ç”¨ Winston æ—¥å¿—åº“ï¼Œæ”¯æŒå¤šçº§åˆ«æ—¥å¿—è¾“å‡ºï¼š

- **å¼€å‘ç¯å¢ƒ**: ä»…æ§åˆ¶å°è¾“å‡º
- **å…¶ä»–ç¯å¢ƒ**: å†™å…¥ `logs/` ç›®å½•
  - `logs/stdout.log`: å¸¸è§„æ—¥å¿—ï¼ˆdebug çº§åˆ«ä»¥ä¸Šï¼‰
  - `logs/stderr.log`: é”™è¯¯æ—¥å¿—ï¼ˆerror çº§åˆ«ï¼‰

## ğŸ” å¾®æœåŠ¡æ¶æ„

### æœåŠ¡åˆ—è¡¨

| æœåŠ¡å | ç«¯å£ | æè¿°                         |
| ------ | ---- | ---------------------------- |
| main   | 3000 | ä¸»æœåŠ¡ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘         |
| auth   | 7999 | è®¤è¯æœåŠ¡ï¼Œå¤„ç†ç”¨æˆ·è®¤è¯å’Œæˆæƒ |

### æœåŠ¡é€šä¿¡

- ä½¿ç”¨ TCP åè®®è¿›è¡Œå¾®æœåŠ¡é—´é€šä¿¡
- æ”¯æŒæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
- å†…ç½®è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

## ğŸš€ éƒ¨ç½²æŒ‡å—

### è‡ªåŠ¨éƒ¨ç½²

é¡¹ç›®æ”¯æŒ GitLab CI/CD è‡ªåŠ¨éƒ¨ç½²ï¼š

```bash
# éƒ¨ç½²å‘½ä»¤ç¤ºä¾‹
cd /home/project && git pull && npm run build && pm2 restart all
```

### æ‰‹åŠ¨éƒ¨ç½²

1. æ‹‰å–æœ€æ–°ä»£ç 
2. å®‰è£…ä¾èµ–
3. æ„å»ºé¡¹ç›®
4. é‡å¯æœåŠ¡

```bash
git pull
npm install
npm run build
pm2 restart all
```

## ğŸ“š API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—® API æ–‡æ¡£ï¼š

- Swagger æ–‡æ¡£: `http://localhost:3000/api`
- API æ¥å£: `http://localhost:3000/api/*`

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- é¡¹ç›® Issues: [GitHub Issues](https://github.com/Lkk-Web/nest-monorepo/issues)
